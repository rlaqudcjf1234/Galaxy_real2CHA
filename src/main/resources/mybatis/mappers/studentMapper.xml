<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.galaxy.mapper.StudentMapper">
    
    <!-- 검색 조건 SQL -->
    <sql id="studentSearch">
        <where>
            <if test="text != null and text != ''">
                AND NAME LIKE '%' || TRIM(#{text}) || '%'
            </if>
        </where>
    </sql>

    <!-- 전체 학생 수 조회 -->
    <select id="selectCount" resultType="int">
        SELECT COUNT(*) FROM STUDENT
        <include refid="studentSearch" />
    </select>

    <!-- 학생 목록 조회 (페이징 적용) -->
    <select id="selectList" resultType="map">
        SELECT 
            SEQ, ID, CLASS_SEQ, JUMIN, NAME, EMAIL, PHONE, REG_DATE
        FROM STUDENT
        <include refid="studentSearch" />
        ORDER BY SEQ DESC
        OFFSET #{offset} ROWS FETCH NEXT #{pageSize} ROWS ONLY
    </select>

    <!-- 학생 상세 조회 -->
    <select id="studentRead" parameterType="int" resultType="map">
        SELECT 
            SEQ, CLASS_SEQ, JUMIN, NAME, EMAIL, PHONE, REG_DATE,
            REAL_ZIPCODE, REAL_ADDRESS1, REAL_ADDRESS2, 
            ZIPCODE, ADDRESS1, ADDRESS2, PATH, ID
        FROM STUDENT
        WHERE SEQ = #{seq}
    </select>

</mapper>
